<html>
<head>
<title>MavenWrapperDownloader.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
MavenWrapperDownloader.java</font>
</center></td></tr></table>
<pre><span class="s0">/* 
 * Copyright 2007-present the original author or authors. 
 * 
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); 
 * you may not use this file except in compliance with the License. 
 * You may obtain a copy of the License at 
 * 
 *      https://www.apache.org/licenses/LICENSE-2.0 
 * 
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, 
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. 
 * See the License for the specific language governing permissions and 
 * limitations under the License. 
 */</span>
<span class="s2">import </span><span class="s1">java</span><span class="s3">.</span><span class="s1">net</span><span class="s3">.*;</span>
<span class="s2">import </span><span class="s1">java</span><span class="s3">.</span><span class="s1">io</span><span class="s3">.*;</span>
<span class="s2">import </span><span class="s1">java</span><span class="s3">.</span><span class="s1">nio</span><span class="s3">.</span><span class="s1">channels</span><span class="s3">.*;</span>
<span class="s2">import </span><span class="s1">java</span><span class="s3">.</span><span class="s1">util</span><span class="s3">.</span><span class="s1">Properties</span><span class="s3">;</span>

<span class="s2">public class </span><span class="s1">MavenWrapperDownloader </span><span class="s3">{</span>

    <span class="s2">private static final </span><span class="s1">String WRAPPER_VERSION </span><span class="s3">= </span><span class="s4">&quot;0.5.6&quot;</span><span class="s3">;</span>
    <span class="s5">/**</span>
     <span class="s5">* Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.</span>
     <span class="s5">*/</span>
    <span class="s2">private static final </span><span class="s1">String DEFAULT_DOWNLOAD_URL </span><span class="s3">= </span><span class="s4">&quot;https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/&quot;</span>
            <span class="s3">+ </span><span class="s1">WRAPPER_VERSION </span><span class="s3">+ </span><span class="s4">&quot;/maven-wrapper-&quot; </span><span class="s3">+ </span><span class="s1">WRAPPER_VERSION </span><span class="s3">+ </span><span class="s4">&quot;.jar&quot;</span><span class="s3">;</span>

    <span class="s5">/**</span>
     <span class="s5">* Path to the maven-wrapper.properties file, which might contain a downloadUrl property to</span>
     <span class="s5">* use instead of the default one.</span>
     <span class="s5">*/</span>
    <span class="s2">private static final </span><span class="s1">String MAVEN_WRAPPER_PROPERTIES_PATH </span><span class="s3">=</span>
            <span class="s4">&quot;.mvn/wrapper/maven-wrapper.properties&quot;</span><span class="s3">;</span>

    <span class="s5">/**</span>
     <span class="s5">* Path where the maven-wrapper.jar will be saved to.</span>
     <span class="s5">*/</span>
    <span class="s2">private static final </span><span class="s1">String MAVEN_WRAPPER_JAR_PATH </span><span class="s3">=</span>
            <span class="s4">&quot;.mvn/wrapper/maven-wrapper.jar&quot;</span><span class="s3">;</span>

    <span class="s5">/**</span>
     <span class="s5">* Name of the property which should be used to override the default download url for the wrapper.</span>
     <span class="s5">*/</span>
    <span class="s2">private static final </span><span class="s1">String PROPERTY_NAME_WRAPPER_URL </span><span class="s3">= </span><span class="s4">&quot;wrapperUrl&quot;</span><span class="s3">;</span>

    <span class="s2">public static void </span><span class="s1">main</span><span class="s3">(</span><span class="s1">String args</span><span class="s3">[]) {</span>
        <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- Downloader started&quot;</span><span class="s3">);</span>
        <span class="s1">File baseDirectory </span><span class="s3">= </span><span class="s2">new </span><span class="s1">File</span><span class="s3">(</span><span class="s1">args</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]);</span>
        <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- Using base directory: &quot; </span><span class="s3">+ </span><span class="s1">baseDirectory</span><span class="s3">.</span><span class="s1">getAbsolutePath</span><span class="s3">());</span>

        <span class="s0">// If the maven-wrapper.properties exists, read it and check if it contains a custom</span>
        <span class="s0">// wrapperUrl parameter.</span>
        <span class="s1">File mavenWrapperPropertyFile </span><span class="s3">= </span><span class="s2">new </span><span class="s1">File</span><span class="s3">(</span><span class="s1">baseDirectory</span><span class="s3">, </span><span class="s1">MAVEN_WRAPPER_PROPERTIES_PATH</span><span class="s3">);</span>
        <span class="s1">String url </span><span class="s3">= </span><span class="s1">DEFAULT_DOWNLOAD_URL</span><span class="s3">;</span>
        <span class="s2">if</span><span class="s3">(</span><span class="s1">mavenWrapperPropertyFile</span><span class="s3">.</span><span class="s1">exists</span><span class="s3">()) {</span>
            <span class="s1">FileInputStream mavenWrapperPropertyFileInputStream </span><span class="s3">= </span><span class="s2">null</span><span class="s3">;</span>
            <span class="s2">try </span><span class="s3">{</span>
                <span class="s1">mavenWrapperPropertyFileInputStream </span><span class="s3">= </span><span class="s2">new </span><span class="s1">FileInputStream</span><span class="s3">(</span><span class="s1">mavenWrapperPropertyFile</span><span class="s3">);</span>
                <span class="s1">Properties mavenWrapperProperties </span><span class="s3">= </span><span class="s2">new </span><span class="s1">Properties</span><span class="s3">();</span>
                <span class="s1">mavenWrapperProperties</span><span class="s3">.</span><span class="s1">load</span><span class="s3">(</span><span class="s1">mavenWrapperPropertyFileInputStream</span><span class="s3">);</span>
                <span class="s1">url </span><span class="s3">= </span><span class="s1">mavenWrapperProperties</span><span class="s3">.</span><span class="s1">getProperty</span><span class="s3">(</span><span class="s1">PROPERTY_NAME_WRAPPER_URL</span><span class="s3">, </span><span class="s1">url</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">IOException e</span><span class="s3">) {</span>
                <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- ERROR loading '&quot; </span><span class="s3">+ </span><span class="s1">MAVEN_WRAPPER_PROPERTIES_PATH </span><span class="s3">+ </span><span class="s4">&quot;'&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s2">finally </span><span class="s3">{</span>
                <span class="s2">try </span><span class="s3">{</span>
                    <span class="s2">if</span><span class="s3">(</span><span class="s1">mavenWrapperPropertyFileInputStream </span><span class="s3">!= </span><span class="s2">null</span><span class="s3">) {</span>
                        <span class="s1">mavenWrapperPropertyFileInputStream</span><span class="s3">.</span><span class="s1">close</span><span class="s3">();</span>
                    <span class="s3">}</span>
                <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">IOException e</span><span class="s3">) {</span>
                    <span class="s0">// Ignore ...</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- Downloading from: &quot; </span><span class="s3">+ </span><span class="s1">url</span><span class="s3">);</span>

        <span class="s1">File outputFile </span><span class="s3">= </span><span class="s2">new </span><span class="s1">File</span><span class="s3">(</span><span class="s1">baseDirectory</span><span class="s3">.</span><span class="s1">getAbsolutePath</span><span class="s3">(), </span><span class="s1">MAVEN_WRAPPER_JAR_PATH</span><span class="s3">);</span>
        <span class="s2">if</span><span class="s3">(!</span><span class="s1">outputFile</span><span class="s3">.</span><span class="s1">getParentFile</span><span class="s3">().</span><span class="s1">exists</span><span class="s3">()) {</span>
            <span class="s2">if</span><span class="s3">(!</span><span class="s1">outputFile</span><span class="s3">.</span><span class="s1">getParentFile</span><span class="s3">().</span><span class="s1">mkdirs</span><span class="s3">()) {</span>
                <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span>
                        <span class="s4">&quot;- ERROR creating output directory '&quot; </span><span class="s3">+ </span><span class="s1">outputFile</span><span class="s3">.</span><span class="s1">getParentFile</span><span class="s3">().</span><span class="s1">getAbsolutePath</span><span class="s3">() + </span><span class="s4">&quot;'&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- Downloading to: &quot; </span><span class="s3">+ </span><span class="s1">outputFile</span><span class="s3">.</span><span class="s1">getAbsolutePath</span><span class="s3">());</span>
        <span class="s2">try </span><span class="s3">{</span>
            <span class="s1">downloadFileFromURL</span><span class="s3">(</span><span class="s1">url</span><span class="s3">, </span><span class="s1">outputFile</span><span class="s3">);</span>
            <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;Done&quot;</span><span class="s3">);</span>
            <span class="s1">System</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s6">0</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s2">catch </span><span class="s3">(</span><span class="s1">Throwable e</span><span class="s3">) {</span>
            <span class="s1">System</span><span class="s3">.</span><span class="s1">out</span><span class="s3">.</span><span class="s1">println</span><span class="s3">(</span><span class="s4">&quot;- Error downloading&quot;</span><span class="s3">);</span>
            <span class="s1">e</span><span class="s3">.</span><span class="s1">printStackTrace</span><span class="s3">();</span>
            <span class="s1">System</span><span class="s3">.</span><span class="s1">exit</span><span class="s3">(</span><span class="s6">1</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s2">private static void </span><span class="s1">downloadFileFromURL</span><span class="s3">(</span><span class="s1">String urlString</span><span class="s3">, </span><span class="s1">File destination</span><span class="s3">) </span><span class="s2">throws </span><span class="s1">Exception </span><span class="s3">{</span>
        <span class="s2">if </span><span class="s3">(</span><span class="s1">System</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;MVNW_USERNAME&quot;</span><span class="s3">) != </span><span class="s2">null </span><span class="s3">&amp;&amp; </span><span class="s1">System</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;MVNW_PASSWORD&quot;</span><span class="s3">) != </span><span class="s2">null</span><span class="s3">) {</span>
            <span class="s1">String username </span><span class="s3">= </span><span class="s1">System</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;MVNW_USERNAME&quot;</span><span class="s3">);</span>
            <span class="s2">char</span><span class="s3">[] </span><span class="s1">password </span><span class="s3">= </span><span class="s1">System</span><span class="s3">.</span><span class="s1">getenv</span><span class="s3">(</span><span class="s4">&quot;MVNW_PASSWORD&quot;</span><span class="s3">).</span><span class="s1">toCharArray</span><span class="s3">();</span>
            <span class="s1">Authenticator</span><span class="s3">.</span><span class="s1">setDefault</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Authenticator</span><span class="s3">() {</span>
                <span class="s1">@Override</span>
                <span class="s2">protected </span><span class="s1">PasswordAuthentication getPasswordAuthentication</span><span class="s3">() {</span>
                    <span class="s2">return new </span><span class="s1">PasswordAuthentication</span><span class="s3">(</span><span class="s1">username</span><span class="s3">, </span><span class="s1">password</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">URL website </span><span class="s3">= </span><span class="s2">new </span><span class="s1">URL</span><span class="s3">(</span><span class="s1">urlString</span><span class="s3">);</span>
        <span class="s1">ReadableByteChannel rbc</span><span class="s3">;</span>
        <span class="s1">rbc </span><span class="s3">= </span><span class="s1">Channels</span><span class="s3">.</span><span class="s1">newChannel</span><span class="s3">(</span><span class="s1">website</span><span class="s3">.</span><span class="s1">openStream</span><span class="s3">());</span>
        <span class="s1">FileOutputStream fos </span><span class="s3">= </span><span class="s2">new </span><span class="s1">FileOutputStream</span><span class="s3">(</span><span class="s1">destination</span><span class="s3">);</span>
        <span class="s1">fos</span><span class="s3">.</span><span class="s1">getChannel</span><span class="s3">().</span><span class="s1">transferFrom</span><span class="s3">(</span><span class="s1">rbc</span><span class="s3">, </span><span class="s6">0</span><span class="s3">, </span><span class="s1">Long</span><span class="s3">.</span><span class="s1">MAX_VALUE</span><span class="s3">);</span>
        <span class="s1">fos</span><span class="s3">.</span><span class="s1">close</span><span class="s3">();</span>
        <span class="s1">rbc</span><span class="s3">.</span><span class="s1">close</span><span class="s3">();</span>
    <span class="s3">}</span>

<span class="s3">}</span></pre>
</body>
</html>